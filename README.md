# –°–∏—Å—Ç–µ–º–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–µ—á–µ–Ω–∏ –Ω–∞ –ö–¢-—Å–∫–∞–Ω–∞—Ö

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–µ—á–µ–Ω–∏ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö —Ç–æ–º–æ–≥—Ä–∞–º–º–∞—Ö (–ö–¢) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã 3D U-Net.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ –¥–≤–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —á–∞—Å—Ç–∏:

```
liver-ct-segmentation-master/
‚îú‚îÄ‚îÄ backend/              # Backend API (Ruby on Rails)
‚îÇ   ‚îú‚îÄ‚îÄ app/             # –ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config/          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Rails
‚îÇ   ‚îú‚îÄ‚îÄ db/              # –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å—Ö–µ–º–∞ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ spec/            # –¢–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îî‚îÄ‚îÄ neural_network/       # –ù–µ–π—Ä–æ—Å–µ—Ç—å –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ (Python)
    ‚îî‚îÄ‚îÄ python_services/
        ‚îî‚îÄ‚îÄ liver_segmentation/
            ‚îú‚îÄ‚îÄ model.py          # 3D U-Net –º–æ–¥–µ–ª—å
            ‚îú‚îÄ‚îÄ inference.py      # –ü–∞–π–ø–ª–∞–π–Ω –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
            ‚îú‚îÄ‚îÄ preprocessing.py  # –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ DICOM
            ‚îî‚îÄ‚îÄ metrics.py        # –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫
```

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### Backend API
- **–ó–∞–≥—Ä—É–∑–∫–∞ DICOM —Ñ–∞–π–ª–æ–≤** —á–µ—Ä–µ–∑ REST API
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏** —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
- **–•—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∫–∞—á–µ—Å—Ç–≤–∞
- **WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** —Å—Ç–∞—Ç—É—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –ù–µ–π—Ä–æ—Å–µ—Ç—å
- **3D U-Net –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –¥–ª—è –æ–±—ä–µ–º–Ω–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ DICOM** –¥–∞–Ω–Ω—ã—Ö (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è HU)
- **–ò–Ω—Ñ–µ—Ä–µ–Ω—Å –Ω–∞ GPU/CPU** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PyTorch
- **–†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞** (Dice, IoU, –æ–±—ä–µ–º –∏ —Ç.–¥.)
- **–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞—Å–æ–∫** —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### Backend (Ruby on Rails)

```bash
# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é backend
cd backend

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
bundle install

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
rails db:create db:migrate

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
rails server
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:3000`

### –ù–µ–π—Ä–æ—Å–µ—Ç—å (Python)

```bash
# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –Ω–µ–π—Ä–æ—Å–µ—Ç–∏
cd neural_network/python_services

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ (–ø—Ä–∏–º–µ—Ä)
python -m liver_segmentation.inference path/to/dicom/file.dcm
```

## üì° API Endpoints

### Health Check
- `GET /api/v1/health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ API

### –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è
- `POST /api/v1/segmentation/upload` - –ó–∞–≥—Ä—É–∑–∫–∞ DICOM —Ñ–∞–π–ª–∞ –∏ –∑–∞–ø—É—Å–∫ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
- `POST /api/v1/segmentations` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ö–¢-—Å–∫–∞–Ω–∞
- `GET /api/v1/segmentations` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
- `GET /api/v1/segmentations/:id` - –î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
- `GET /api/v1/segmentations/:id/result` - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- `GET /api/v1/segmentations/:id/download_mask` - –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –º–∞—Å–∫–∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ó–∞–≥—Ä—É–∑–∫–∞ DICOM —Ñ–∞–π–ª–∞ –∏ –∑–∞–ø—É—Å–∫ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏

```bash
curl -X POST http://localhost:3000/api/v1/segmentation/upload \
  -F "file=@path/to/dicom/file.dcm" \
  -F "patient_id=ANON_12345"
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
curl http://localhost:3000/api/v1/segmentations/1/result
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Backend (Rails)

**–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö:**
- `CtScan` - –ö–¢-—Å–∫–∞–Ω—ã —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- `SegmentationTask` - –ó–∞–¥–∞—á–∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
- `SegmentationResult` - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∫–∞—á–µ—Å—Ç–≤–∞

**–°–µ—Ä–≤–∏—Å—ã:**
- `DicomProcessingService` - –û–±—Ä–∞–±–æ—Ç–∫–∞ DICOM —Ñ–∞–π–ª–æ–≤
- `LiverSegmentationService` - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
- `MetricsCalculationService` - –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞

**–§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏:**
- `SegmentationProcessorJob` - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏

### –ù–µ–π—Ä–æ—Å–µ—Ç—å (Python)

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `UNet3D` - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ 3D U-Net –¥–ª—è –æ–±—ä–µ–º–Ω–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
- `LiverSegmentationModel` - –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—å—é
- `LiverSegmentationInference` - –ü–∞–π–ø–ª–∞–π–Ω –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ –æ—Ç DICOM –¥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `DicomPreprocessor` - –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ DICOM —Ñ–∞–π–ª–æ–≤
- –ú–µ—Ç—Ä–∏–∫–∏: –†–∞—Å—á–µ—Ç Dice, IoU –∏ –¥—Ä—É–≥–∏—Ö –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏:

- **Dice Coefficient** (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–æ—Ä–µ–Ω—Å–µ–Ω–∞-–î–∞–π—Å–∞) - –æ—Ç 0 –¥–æ 1
- **IoU** (Intersection over Union) - –æ—Ç 0 –¥–æ 1
- **Sensitivity** (—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å) - –æ—Ç 0 –¥–æ 1
- **Specificity** (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ—Å—Ç—å) - –æ—Ç 0 –¥–æ 1
- **Pixel Accuracy** (—Ç–æ—á–Ω–æ—Å—Ç—å –ø–∏–∫—Å–µ–ª–µ–π) - –æ—Ç 0 –¥–æ 1
- **–û–±—ä–µ–º –ø–µ—á–µ–Ω–∏** –≤ –º–∏–ª–ª–∏–ª–∏—Ç—Ä–∞—Ö

### –ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã

–î–ª—è –∫–ª–∏–Ω–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- **Dice Coefficient >= 0.90**
- **IoU >= 0.90**

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ç–∞–∫–∏–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º.

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend
- **Ruby on Rails 7.x** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Active Storage** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- **GoodJob** - —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- **ActionCable** - WebSocket –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞

### –ù–µ–π—Ä–æ—Å–µ—Ç—å
- **PyTorch 2.0+** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –≥–ª—É–±–æ–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
- **pydicom** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ DICOM —Ñ–∞–π–ª–æ–≤
- **NumPy, SciPy** - –Ω–∞—É—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
- **OpenCV** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Backend README](backend/README.md) - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ backend API
- [Neural Network README](neural_network/python_services/README.md) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### Backend
- Ruby 3.x
- Rails 7.x
- PostgreSQL

### –ù–µ–π—Ä–æ—Å–µ—Ç—å
- Python 3.8+
- PyTorch 2.0+
- CUDA (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è GPU —É—Å–∫–æ—Ä–µ–Ω–∏—è)
