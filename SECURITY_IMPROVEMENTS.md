# Улучшения безопасности

## Реализованные улучшения безопасности

### 1. Аутентификация и авторизация
- ✅ Добавлена JWT-аутентификация (`app/core/security.py`)
- ✅ Endpoint для входа (`/api/v1/auth/login`)
- ✅ Проверка токенов через middleware
- ✅ Хеширование паролей с использованием bcrypt

### 2. Валидация входных данных
- ✅ Валидация расширений файлов (только .dcm)
- ✅ Проверка размера файлов (MAX_UPLOAD_SIZE)
- ✅ Санитизация имен файлов (защита от path traversal)
- ✅ Проверка путей файлов перед сохранением

### 3. Middleware безопасности
- ✅ SecurityHeadersMiddleware - добавляет заголовки безопасности
- ✅ RateLimitMiddleware - ограничение количества запросов (60/мин)
- ✅ RequestLoggingMiddleware - логирование всех запросов для мониторинга

### 4. Логирование безопасности
- ✅ Отдельный файл логов для безопасности (`logs/security_*.log`)
- ✅ Логирование всех попыток загрузки файлов
- ✅ Логирование ошибок аутентификации
- ✅ Логирование подозрительной активности

### 5. Конфигурация безопасности
- ✅ Предупреждения при использовании дефолтного SECRET_KEY
- ✅ Ограничение CORS (по умолчанию только localhost)
- ✅ Настройка через переменные окружения

## Рекомендации для production

1. **Обязательно измените SECRET_KEY** в переменных окружения
2. **Настройте CORS_ORIGINS** для вашего домена
3. **Используйте HTTPS** в production
4. **Настройте rate limiting** через Redis (сейчас in-memory)
5. **Включите логирование в централизованную систему**
6. **Регулярно проверяйте логи безопасности**
7. **Настройте резервное копирование базы данных**
8. **Используйте firewall** для ограничения доступа

## Использование

### Создание администратора
При первом запуске с DEBUG=True, можно войти с:
- username: `admin`
- password: `admin`

**ВАЖНО:** Измените пароль сразу после первого входа!

### Получение токена
```bash
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin"}'
```

### Использование токена
```bash
curl http://localhost:8000/api/v1/segmentations \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

